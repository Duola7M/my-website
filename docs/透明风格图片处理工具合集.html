<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>透明风格图片处理工具合集</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            /* background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); */
            background: url('images/background3.jpg') center center/cover no-repeat;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
             background: rgba(255,255,255,0.25); /* 透明背景 */
            border-radius: 10px;
            color: rgb(8, 6, 6);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .description {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
             background: rgba(255,255,255,0.25); /* 透明背景 */
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
             background: rgba(255,255,255,0.25); /* 透明背景 */
        }
        
        .tab.active {
             background: rgba(255,255,255,0.75); /* 透明背景 */
            color: rgb(3, 3, 3);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .card {
             background: rgba(255,255,255,0.25); /* 透明背景 */
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        
        .card-title {
            font-size: 1.4rem;
            color: #1565c0;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e3f2fd;
            text-align: center;
        }
        
        .drop-area {
            border: 3px dashed #64b5f6;
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
             background: rgba(255,255,255,0.25); /* 透明背景 */
        }
        
        .drop-area.highlight {
            background-color: #e3f2fd;
            border-color: #2196f3;
        }
        
        .drop-area p {
            margin: 15px 0;
            color: #546e7a;
        }
        
        .drop-area i {
            font-size: 60px;
            color: #2196f3;
            margin-bottom: 15px;
        }
        
        .image-list {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
            min-height: 180px;
            justify-content: center;
        }
        
        .image-item {
            width: 150px;
            position: relative;
            border: 2px solid #bbdefb;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            cursor: grab;
            transition: transform 0.2s;
        }
        
        .image-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            border-color: #64b5f6;
        }
        
        .image-item img {
            width: 100%;
            height: 130px;
            object-fit: cover;
            display: block;
        }
        
        .image-item .number {
            position: absolute;
            top: 8px;
            left: 8px;
            background-color: #2196f3;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .image-item .remove {
            position: absolute;
            top: 8px;
            right: 8px;
            background-color: #f44336;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 160px;
            justify-content: center;
        }
        
        .btn-primary {
            background: linear-gradient(to right, #2196f3, #1976d2);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(to right, #1976d2, #1565c0);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(33, 150, 243, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(to right, #4caf50, #2e7d32);
            color: white;
        }
        
        .btn-success:hover {
            background: linear-gradient(to right, #2e7d32, #1b5e20);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(to right, #f44336, #c62828);
            color: white;
        }
        
        .btn-danger:hover {
            background: linear-gradient(to right, #c62828, #b71c1c);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(244, 67, 54, 0.3);
        }
        
        .preview-container {
            width: 100%;
            overflow-x: auto;
            margin-top: 20px;
            border: 2px dashed #bbdefb;
            border-radius: 8px;
            min-height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
             background: rgba(255,255,255,0.25); /* 透明背景 */
        }
        
        .previewCanvas {
            max-width: 100%;
            display: block;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }
        
        .hidden {
            display: none;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            color: #546e7a;
            font-size: 0.9rem;
            padding: 20px;
        }
        
        .instructions {
            margin-top: 20px;
            padding: 20px;
             background: rgba(255,255,255,0.25); /* 透明背景 */
            border-radius: 8px;
            border-left: 5px solid #2196f3;
        }
        
        .instructions h3 {
            color: #1565c0;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .instructions ol {
            padding-left: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        /* 裁切工具特定样式 */
        .crop-wrapper {
            position: relative;
            margin: 0 auto;
            max-width: 100%;
            text-align: center;
            display: flex;
            justify-content: center;
        }
        
        .crop-container {
            position: relative;
            display: inline-block;
            max-width: 100%;
        }
        
        .crop-image-container {
            max-width: 100%;
            max-height: 400px;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #cropImage {
            max-width: 100%;
            max-height: 400px;
            display: block;
        }
        
        .crop-area {
            position: absolute;
            border: 2px dashed #ff5722;
            background-color: rgba(255, 87, 34, 0.1);
            cursor: move;
        }
        
        .crop-handle {
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: #ff5722;
            border-radius: 50%;
        }
        
        .handle-nw {
            top: -6px;
            left: -6px;
            cursor: nw-resize;
        }
        
        .handle-ne {
            top: -6px;
            right: -6px;
            cursor: ne-resize;
        }
        
        .handle-sw {
            bottom: -6px;
            left: -6px;
            cursor: sw-resize;
        }
        
        .handle-se {
            bottom: -6px;
            right: -6px;
            cursor: se-resize;
        }
        
        .crop-controls {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        .crop-input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .crop-input {
            padding: 10px;
            border: 2px solid #bbdefb;
            border-radius: 6px;
            width: 100px;
            text-align: center;
            margin-top: 5px;
        }
        
        .crop-input-label {
            font-weight: bold;
            color: #1565c0;
            font-size: 0.9rem;
        }
        
        .aspect-ratio-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .aspect-btn {
            padding: 8px 15px;
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .aspect-btn:hover {
            background: #bbdefb;
        }
        
        .aspect-btn.active {
            background: #2196f3;
            color: white;
            border-color: #1976d2;
        }
        
        .output-options {
            margin-top: 20px;
            padding: 15px;
            background-color: #e3f2fd;
            border-radius: 8px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }
        
        .option-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .option-label {
            font-weight: bold;
            color: #1565c0;
            margin-bottom: 5px;
        }
        
        .option-select, .option-range {
            padding: 8px;
            border: 2px solid #bbdefb;
            border-radius: 6px;
            background: white;
        }
        
        .file-info {
            margin-top: 15px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 6px;
            text-align: center;
            font-size: 0.9rem;
        }
        
        /* 旋转工具特定样式 */
        .transform-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 8px;
            min-width: 200px;
        }
        
        .control-title {
            font-weight: bold;
            color: #1565c0;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .rotation-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .rotation-btn {
            padding: 10px 15px;
            background: #bbdefb;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .rotation-btn:hover {
            background: #90caf9;
        }
        
        .rotation-slider {
            width: 100%;
            margin: 15px 0;
        }
        
        .rotation-value {
            font-weight: bold;
            color: #1565c0;
            margin-top: 5px;
        }
        
        .quality-value {
            font-weight: bold;
            color: #1565c0;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 100%;
                max-width: 280px;
            }
            
            .image-item {
                width: 120px;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .crop-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .aspect-ratio-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .output-options {
                flex-direction: column;
                align-items: center;
            }
            
            .transform-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .control-group {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-images"></i> 图片处理工具合集</h1>
            <p class="description">拖放图片，进行拼接、裁切、旋转和格式转换操作</p>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="vertical">竖向拼接</div>
            <div class="tab" data-tab="horizontal">水平拼接</div>
            <div class="tab" data-tab="crop">图片裁切</div>
            <div class="tab" data-tab="transform">旋转与转换</div>
        </div>
        
        <div class="main-content">
            <!-- 竖向拼接内容 -->
            <div class="tab-content active" id="verticalContent">
                <section class="card">
                    <h2 class="card-title"><i class="fas fa-upload"></i> 上传图片</h2>
                    <div class="drop-area" id="verticalDropArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>将图片拖放到此处，或<strong>点击选择图片</strong></p>
                        <p>支持JPG, PNG, GIF格式</p>
                        <input type="file" id="verticalFileInput" accept="image/*" multiple class="hidden">
                    </div>
                </section>
                
                <section class="card">
                    <h2 class="card-title"><i class="fas fa-list"></i> 图片列表</h2>
                    <div class="image-list" id="verticalImageList">
                        <p style="align-self: center; color: #78909c;">上传的图片将显示在这里</p>
                    </div>
                </section>
                
                <section class="card">
                    <h2 class="card-title"><i class="fas fa-sliders-h"></i> 操作控制</h2>
                    <div class="controls">
                        <button id="verticalClearBtn" class="btn-danger">
                            <i class="fas fa-trash"></i> 清空列表
                        </button>
                        <button id="verticalProcessBtn" class="btn-success">
                            <i class="fas fa-cogs"></i> 竖向拼接图片
                        </button>
                        <button id="verticalDownloadBtn" class="btn-primary" disabled>
                            <i class="fas fa-download"></i> 下载结果
                        </button>
                    </div>
                </section>
                
                <section class="card">
                    <h2 class="card-title"><i class="fas fa-eye"></i> 预览</h2>
                    <div class="preview-container">
                        <canvas id="verticalResultCanvas" class="previewCanvas"></canvas>
                    </div>
                </section>
                
                <div class="instructions">
                    <h3><i class="fas fa-info-circle"></i> 竖向拼接使用说明</h3>
                    <ol>
                        <li>上传多张需要拼接的图片</li>
                        <li>拖拽图片调整顺序（第一张在最上面）</li>
                        <li>点击"竖向拼接图片"按钮生成结果</li>
                        <li>满意后点击"下载结果"保存图片</li>
                    </ol>
                </div>
            </div>
            
            <!-- 水平拼接内容 -->
            <div class="tab-content" id="horizontalContent">
                <section class="card">
                    <h2 class="card-title"><i class="fas fa-upload"></i> 上传图片</h2>
                    <div class="drop-area" id="horizontalDropArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>将图片拖放到此处，或<strong>点击选择图片</strong></p>
                        <p>支持JPG, PNG, GIF格式</p>
                        <input type="file" id="horizontalFileInput" accept="image/*" multiple class="hidden">
                    </div>
                </section>
                
                <section class="card">
                    <h2 class="card-title"><i class="fas fa-list"></i> 图片列表</h2>
                    <div class="image-list" id="horizontalImageList">
                        <p style="align-self: center; color: #78909c;">上传的图片将显示在这里</p>
                    </div>
                </section>
                
                <section class="card">
                    <h2 class="card-title"><i class="fas fa-sliders-h"></i> 操作控制</h2>
                    <div class="controls">
                        <button id="horizontalClearBtn" class="btn-danger">
                            <i class="fas fa-trash"></i> 清空列表
                        </button>
                        <button id="horizontalProcessBtn" class="btn-success">
                            <i class="fas fa-cogs"></i> 水平拼接图片
                        </button>
                        <button id="horizontalDownloadBtn" class="btn-primary" disabled>
                            <i class="fas fa-download"></i> 下载结果
                        </button>
                    </div>
                </section>
                
                <section class="card">
                    <h2 class="card-title"><i class="fas fa-eye"></i> 预览</h2>
                    <div class="preview-container">
                        <canvas id="horizontalResultCanvas" class="previewCanvas"></canvas>
                    </div>
                </section>
                
                <div class="instructions">
                    <h3><i class="fas fa-info-circle"></i> 水平拼接使用说明</h3>
                    <ol>
                        <li>上传多张需要拼接的图片</li>
                        <li>拖拽图片调整顺序（第一张在最左边）</li>
                        <li>点击"水平拼接图片"按钮生成结果</li>
                        <li>满意后点击"下载结果"保存图片</li>
                    </ol>
                </div>
            </div>
            
            <!-- 图片裁切内容 -->
            <div class="tab-content" id="cropContent">
                <section class="card">
                    <h2 class="card-title"><i class="fas fa-upload"></i> 上传图片</h2>
                    <div class="drop-area" id="cropDropArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>将图片拖放到此处，或<strong>点击选择图片</strong></p>
                        <p>支持JPG, PNG, GIF格式</p>
                        <input type="file" id="cropFileInput" accept="image/*" class="hidden">
                    </div>
                    <div id="cropFileInfo" class="file-info hidden">
                        原图信息: <span id="fileSize">未知</span>, <span id="fileDimensions">未知尺寸</span>, <span id="fileType">未知格式</span>
                    </div>
                </section>
                
                <section class="card">
                    <h2 class="card-title"><i class="fas fa-crop-alt"></i> 裁切区域</h2>
                    <div class="preview-container">
                        <div class="crop-wrapper">
                            <div class="crop-container">
                                <div class="crop-image-container">
                                    <img id="cropImage" src="" alt="裁切预览" class="hidden">
                                </div>
                                <div id="cropArea" class="crop-area hidden">
                                    <div class="crop-handle handle-nw"></div>
                                    <div class="crop-handle handle-ne"></div>
                                    <div class="crop-handle handle-sw"></div>
                                    <div class="crop-handle handle-se"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="crop-controls">
                        <div class="crop-input-group">
                            <span class="crop-input-label">宽度</span>
                            <input type="number" id="cropWidth" class="crop-input" placeholder="宽度" min="1">
                        </div>
                        <div class="crop-input-group">
                            <span class="crop-input-label">高度</span>
                            <input type="number" id="cropHeight" class="crop-input" placeholder="高度" min="1">
                        </div>
                        <div class="crop-input-group">
                            <span class="crop-input-label">X坐标</span>
                            <input type="number" id="cropX" class="crop-input" placeholder="X" min="0">
                        </div>
                        <div class="crop-input-group">
                            <span class="crop-input-label">Y坐标</span>
                            <input type="number" id="cropY" class="crop-input" placeholder="Y" min="0">
                        </div>
                    </div>
                    
                    <div class="aspect-ratio-buttons">
                        <div class="aspect-input-group">
                            <span class="crop-input-label">常用比例</span>
                            <div style="display: flex; gap: 5px; margin-top: 5px;">
                                <button class="aspect-btn" data-ratio="1">1:1</button>
                                <button class="aspect-btn" data-ratio="0.75">4:3</button>
                                <button class="aspect-btn" data-ratio="0.5625">16:9</button>
                                <button class="aspect-btn" data-ratio="1.333">3:4</button>
                                <button class="aspect-btn" data-ratio="1.777">9:16</button>
                            </div>
                        </div>
                    </div>
                </section>
                
                <section class="card">
                    <h2 class="card-title"><i class="fas fa-sliders-h"></i> 输出选项</h2>
                    <div class="output-options">
                        <div class="option-group">
                            <span class="option-label">输出格式</span>
                            <select id="cropOutputFormat" class="option-select">
                                <option value="image/jpeg">JPEG</option>
                                <option value="image/png">PNG</option>
                                <option value="image/webp">WebP</option>
                            </select>
                        </div>
                        <div class="option-group">
                            <span class="option-label">JPEG质量</span>
                            <input type="range" id="cropJpegQuality" class="option-range" min="0.1" max="1.0" step="0.1" value="0.8">
                            <span id="cropQualityValue">80%</span>
                        </div>
                        <div class="option-group">
                            <span class="option-label">调整尺寸</span>
                            <input type="number" id="resizeWidth" class="crop-input" placeholder="宽度" min="1">
                            <span style="margin: 5px;">×</span>
                            <input type="number" id="resizeHeight" class="crop-input" placeholder="高度" min="1">
                        </div>
                    </div>
                </section>
                
                <section class="card">
                    <h2 class="card-title"><i class="fas fa-sliders-h"></i> 操作控制</h2>
                    <div class="controls">
                        <button id="cropReset" class="btn-primary">
                            <i class="fas fa-redo"></i> 重置裁切区域
                        </button>
                        <button id="cropImageBtn" class="btn-success" disabled>
                            <i class="fas fa-crop-alt"></i> 裁切图片
                        </button>
                        <button id="cropDownloadBtn" class="btn-primary" disabled>
                            <i class="fas fa-download"></i> 下载裁切图
                        </button>
                    </div>
                </section>
                
                <section class="card">
                    <h2 class="card-title"><i class="fas fa-eye"></i> 裁切结果预览</h2>
                    <div class="preview-container">
                        <canvas id="cropResultCanvas" class="previewCanvas"></canvas>
                    </div>
                    <div id="cropResultInfo" class="file-info hidden" style="margin-top: 15px;">
                        裁切后信息: <span id="resultSize">未知</span>, <span id="resultDimensions">未知尺寸</span>
                    </div>
                </section>
                
                <div class="instructions">
                    <h3><i class="fas fa-info-circle"></i> 图片裁切使用说明</h3>
                    <ol>
                        <li>上传一张需要裁切的图片</li>
                        <li>拖拽裁切框的边角或中心调整裁切区域</li>
                        <li>选择输出格式和质量设置以控制文件大小</li>
                        <li>点击"裁切图片"按钮生成裁切结果</li>
                        <li>满意后点击"下载裁切图"保存结果</li>
                    </ol>
                    <p style="margin-top: 15px; color: #d32f2f;">
                        <strong>文件大小提示:</strong> 如果裁切后文件变大，请尝试降低JPEG质量或选择WebP格式。
                        PNG格式通常会产生较大的文件，适合需要透明背景的情况。
                    </p>
                </div>
            </div>
            
            <!-- 图片旋转与转换内容 -->
            <div class="tab-content" id="transformContent">
                <section class="card">
                    <h2 class="card-title"><i class="fas fa-upload"></i> 上传图片</h2>
                    <div class="drop-area" id="transformDropArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>将图片拖放到此处，或<strong>点击选择图片</strong></p>
                        <p>支持JPG, PNG, GIF, WebP格式</p>
                        <input type="file" id="transformFileInput" accept="image/*" class="hidden">
                    </div>
                    <div id="transformFileInfo" class="file-info hidden">
                        原图信息: <span id="transformFileSize">未知</span>, <span id="transformFileDimensions">未知尺寸</span>, <span id="transformFileType">未知格式</span>
                    </div>
                </section>
                
                <section class="card">
                    <h2 class="card-title"><i class="fas fa-cog"></i> 旋转与转换设置</h2>
                    <div class="transform-controls">
                        <div class="control-group">
                            <div class="control-title">旋转操作</div>
                            <div class="rotation-buttons">
                                <button class="rotation-btn" id="rotateLeftBtn">
                                    <i class="fas fa-undo"></i> 左旋90°
                                </button>
                                <button class="rotation-btn" id="rotateRightBtn">
                                    <i class="fas fa-redo"></i> 右旋90°
                                </button>
                                <button class="rotation-btn" id="flipHorizontalBtn">
                                    <i class="fas fa-arrows-alt-h"></i> 水平翻转
                                </button>
                                <button class="rotation-btn" id="flipVerticalBtn">
                                    <i class="fas fa-arrows-alt-v"></i> 垂直翻转
                                </button>
                            </div>
                            <div style="width: 100%; margin-top: 15px;">
                                <div class="option-label">自定义旋转角度</div>
                                <input type="range" id="rotationSlider" class="rotation-slider" min="0" max="360" value="0" step="1">
                                <div class="rotation-value" id="rotationValue">0°</div>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <div class="control-title">输出选项</div>
                            <div class="option-group">
                                <span class="option-label">输出格式</span>
                                <select id="transformOutputFormat" class="option-select">
                                    <option value="image/jpeg">JPEG</option>
                                    <option value="image/png">PNG</option>
                                    <option value="image/webp">WebP</option>
                                </select>
                            </div>
                            <div class="option-group">
                                <span class="option-label">JPEG质量</span>
                                <input type="range" id="transformJpegQuality" class="option-range" min="0.1" max="1.0" step="0.1" value="0.8">
                                <span class="quality-value" id="transformQualityValue">80%</span>
                            </div>
                        </div>
                    </div>
                </section>
                
                <section class="card">
                    <h2 class="card-title"><i class="fas fa-sliders-h"></i> 操作控制</h2>
                    <div class="controls">
                        <button id="resetTransformBtn" class="btn-primary">
                            <i class="fas fa-redo"></i> 重置图片
                        </button>
                        <button id="applyTransformBtn" class="btn-success" disabled>
                            <i class="fas fa-check"></i> 应用转换
                        </button>
                        <button id="transformDownloadBtn" class="btn-primary" disabled>
                            <i class="fas fa-download"></i> 下载图片
                        </button>
                    </div>
                </section>
                
                <section class="card">
                    <h2 class="card-title"><i class="fas fa-eye"></i> 预览</h2>
                    <div class="preview-container">
                        <canvas id="transformPreviewCanvas" class="previewCanvas"></canvas>
                    </div>
                    <div id="transformResultInfo" class="file-info hidden" style="margin-top: 15px;">
                        处理后信息: <span id="transformResultSize">未知</span>, <span id="transformResultDimensions">未知尺寸</span>
                    </div>
                </section>
                
                <div class="instructions">
                    <h3><i class="fas fa-info-circle"></i> 图片旋转与转换使用说明</h3>
                    <ol>
                        <li>上传一张需要处理的图片</li>
                        <li>使用旋转按钮或滑块调整图片方向</li>
                        <li>选择输出格式和质量设置</li>
                        <li>点击"应用转换"按钮生成处理结果</li>
                        <li>满意后点击"下载图片"保存结果</li>
                    </ol>
                    <p style="margin-top: 15px; color: #d32f2f;">
                        <strong>注意:</strong> 所有操作均在浏览器中进行，您的图片不会上传到服务器。
                    </p>
                </div>
            </div>
        </div>
        
        <footer>
            <p>© 2023 蓝白风格图片处理工具合集 | 使用HTML5 Canvas技术 | 完全在浏览器中运行，您的图片不会上传到服务器</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 选项卡切换功能
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    // 更新选项卡激活状态
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // 更新内容显示
                    tabContents.forEach(content => content.classList.remove('active'));
                    document.getElementById(tabId + 'Content').classList.add('active');
                });
            });
            
            // 初始化拼接工具
            initStitchTool('vertical');
            initStitchTool('horizontal');
            
            // 初始化裁切工具
            initCropTool();
            
            // 初始化旋转与转换工具
            initTransformTool();
            
            function initStitchTool(type) {
                const dropArea = document.getElementById(type + 'DropArea');
                const fileInput = document.getElementById(type + 'FileInput');
                const imageList = document.getElementById(type + 'ImageList');
                const clearBtn = document.getElementById(type + 'ClearBtn');
                const processBtn = document.getElementById(type + 'ProcessBtn');
                const downloadBtn = document.getElementById(type + 'DownloadBtn');
                const resultCanvas = document.getElementById(type + 'ResultCanvas');
                const ctx = resultCanvas.getContext('2d');
                
                let images = [];
                let currentDraggedItem = null;
                
                // 拖放事件处理
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropArea.addEventListener(eventName, preventDefaults, false);
                });
                
                function preventDefaults(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                
                ['dragenter', 'dragover'].forEach(eventName => {
                    dropArea.addEventListener(eventName, highlight, false);
                });
                
                ['dragleave', 'drop'].forEach(eventName => {
                    dropArea.addEventListener(eventName, unhighlight, false);
                });
                
                function highlight() {
                    dropArea.classList.add('highlight');
                }
                
                function unhighlight() {
                    dropArea.classList.remove('highlight');
                }
                
                // 处理文件拖放
                dropArea.addEventListener('drop', handleDrop, false);
                
                function handleDrop(e) {
                    const dt = e.dataTransfer;
                    const files = dt.files;
                    handleFiles(files);
                }
                
                // 点击选择文件
                dropArea.addEventListener('click', () => {
                    fileInput.click();
                });
                
                fileInput.addEventListener('change', () => {
                    handleFiles(fileInput.files);
                });
                
                // 处理上传的文件
                function handleFiles(files) {
                    if (files.length === 0) return;
                    
                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        if (!file.type.match('image.*')) continue;
                        
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const img = new Image();
                            img.onload = function() {
                                images.push({
                                    file: file,
                                    dataUrl: e.target.result,
                                    image: img,
                                    width: img.width,
                                    height: img.height
                                });
                                
                                updateImageList();
                            };
                            img.src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                }
                
                // 更新图片列表显示
                function updateImageList() {
                    imageList.innerHTML = '';
                    
                    if (images.length === 0) {
                        imageList.innerHTML = '<p style="align-self: center; color: #78909c;">上传的图片将显示在这里</p>';
                        return;
                    }
                    
                    images.forEach((imgData, index) => {
                        const item = document.createElement('div');
                        item.className = 'image-item';
                        item.draggable = true;
                        item.dataset.index = index;
                        
                        item.innerHTML = `
                            <div class="number">${index + 1}</div>
                            <div class="remove">&times;</div>
                            <img src="${imgData.dataUrl}" alt="预览图">
                        `;
                        
                        // 拖拽排序功能
                        item.addEventListener('dragstart', function(e) {
                            currentDraggedItem = this;
                            e.dataTransfer.effectAllowed = 'move';
                            e.dataTransfer.setData('text/plain', this.dataset.index);
                            setTimeout(() => this.style.opacity = '0.4', 0);
                        });
                        
                        item.addEventListener('dragover', function(e) {
                            e.preventDefault();
                            e.dataTransfer.dropEffect = 'move';
                        });
                        
                        item.addEventListener('dragenter', function(e) {
                            this.classList.add('over');
                        });
                        
                        item.addEventListener('dragleave', function(e) {
                            this.classList.remove('over');
                        });
                        
                        item.addEventListener('drop', function(e) {
                            e.preventDefault();
                            if (currentDraggedItem !== this) {
                                const fromIndex = parseInt(currentDraggedItem.dataset.index);
                                const toIndex = parseInt(this.dataset.index);
                                
                                // 重新排序数组
                                const movedItem = images.splice(fromIndex, 1)[0];
                                images.splice(toIndex, 0, movedItem);
                                
                                updateImageList();
                            }
                            this.classList.remove('over');
                        });
                        
                        item.addEventListener('dragend', function(e) {
                            this.style.opacity = '1';
                            document.querySelectorAll('.image-item.over').forEach(item => {
                                item.classList.remove('over');
                            });
                        });
                        
                        // 删除功能
                        const removeBtn = item.querySelector('.remove');
                        removeBtn.addEventListener('click', function(e) {
                            e.stopPropagation();
                            const index = parseInt(item.dataset.index);
                            images.splice(index, 1);
                            updateImageList();
                        });
                        
                        imageList.appendChild(item);
                    });
                }
                
                // 清空按钮
                clearBtn.addEventListener('click', function() {
                    images = [];
                    updateImageList();
                    ctx.clearRect(0, 0, resultCanvas.width, resultCanvas.height);
                    downloadBtn.disabled = true;
                });
                
                // 处理按钮
                processBtn.addEventListener('click', function() {
                    if (images.length < 1) {
                        alert('请至少上传一张图片');
                        return;
                    }
                    
                    if (type === 'vertical') {
                        processVerticalStitch();
                    } else {
                        processHorizontalStitch();
                    }
                    
                    downloadBtn.disabled = false;
                });
                
                // 竖向拼接处理
                function processVerticalStitch() {
                    // 计算总高度和最大宽度
                    let totalHeight = 0;
                    let maxWidth = 0;
                    
                    images.forEach(imgData => {
                        totalHeight += imgData.height;
                        if (imgData.width > maxWidth) maxWidth = imgData.width;
                    });
                    
                    // 设置Canvas尺寸
                    resultCanvas.width = maxWidth;
                    resultCanvas.height = totalHeight;
                    
                    // 清除Canvas
                    ctx.clearRect(0, 0, resultCanvas.width, resultCanvas.height);
                    
                    // 绘制图片
                    let currentY = 0;
                    images.forEach(imgData => {
                        const scale = maxWidth / imgData.width;
                        const scaledHeight = imgData.height * scale;
                        
                        ctx.drawImage(
                            imgData.image,
                            0, currentY,
                            maxWidth, scaledHeight
                        );
                        
                        currentY += scaledHeight;
                    });
                }
                
                // 水平拼接处理
                function processHorizontalStitch() {
                    // 计算总宽度和最大高度
                    let totalWidth = 0;
                    let maxHeight = 0;
                    
                    images.forEach(imgData => {
                        totalWidth += imgData.width;
                        if (imgData.height > maxHeight) maxHeight = imgData.height;
                    });
                    
                    // 设置Canvas尺寸
                    resultCanvas.width = totalWidth;
                    resultCanvas.height = maxHeight;
                    
                    // 清除Canvas
                    ctx.clearRect(0, 0, resultCanvas.width, resultCanvas.height);
                    
                    // 绘制图片
                    let currentX = 0;
                    images.forEach(imgData => {
                        const scale = maxHeight / imgData.height;
                        const scaledWidth = imgData.width * scale;
                        
                        ctx.drawImage(
                            imgData.image,
                            currentX, 0,
                            scaledWidth, maxHeight
                        );
                        
                        currentX += scaledWidth;
                    });
                }
                
                // 下载按钮
                downloadBtn.addEventListener('click', function() {
                    if (resultCanvas.width === 0) return;
                    
                    const link = document.createElement('a');
                    link.download = 'image-' + type + '-stitch-' + new Date().getTime() + '.png';
                    link.href = resultCanvas.toDataURL('image/png');
                    link.click();
                });
            }
            
            function initCropTool() {
                const dropArea = document.getElementById('cropDropArea');
                const fileInput = document.getElementById('cropFileInput');
                const cropImage = document.getElementById('cropImage');
                const cropArea = document.getElementById('cropArea');
                const cropWidthInput = document.getElementById('cropWidth');
                const cropHeightInput = document.getElementById('cropHeight');
                const cropXInput = document.getElementById('cropX');
                const cropYInput = document.getElementById('cropY');
                const cropResetBtn = document.getElementById('cropReset');
                const cropImageBtn = document.getElementById('cropImageBtn');
                const cropDownloadBtn = document.getElementById('cropDownloadBtn');
                const cropResultCanvas = document.getElementById('cropResultCanvas');
                const outputFormat = document.getElementById('cropOutputFormat');
                const jpegQuality = document.getElementById('cropJpegQuality');
                const qualityValue = document.getElementById('cropQualityValue');
                const resizeWidth = document.getElementById('resizeWidth');
                const resizeHeight = document.getElementById('resizeHeight');
                const fileInfo = document.getElementById('cropFileInfo');
                const fileSize = document.getElementById('fileSize');
                const fileDimensions = document.getElementById('fileDimensions');
                const fileType = document.getElementById('fileType');
                const resultInfo = document.getElementById('cropResultInfo');
                const resultSize = document.getElementById('resultSize');
                const resultDimensions = document.getElementById('resultDimensions');
                const ctx = cropResultCanvas.getContext('2d');
                const aspectButtons = document.querySelectorAll('.aspect-btn');
                
                let isDragging = false;
                let dragHandle = null;
                let startX, startY;
                let cropX = 0, cropY = 0, cropWidth = 0, cropHeight = 0;
                let imgWidth = 0, imgHeight = 0;
                let scaleFactor = 1;
                let originalWidth = 0, originalHeight = 0;
                let originalFileSize = 0;
                let originalFileType = '';
                
                // 更新质量显示
                jpegQuality.addEventListener('input', function() {
                    qualityValue.textContent = Math.round(this.value * 100) + '%';
                });
                
                // 拖放事件处理
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropArea.addEventListener(eventName, preventDefaults, false);
                });
                
                function preventDefaults(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                
                ['dragenter', 'dragover'].forEach(eventName => {
                    dropArea.addEventListener(eventName, highlight, false);
                });
                
                ['dragleave', 'drop'].forEach(eventName => {
                    dropArea.addEventListener(eventName, unhighlight, false);
                });
                
                function highlight() {
                    dropArea.classList.add('highlight');
                }
                
                function unhighlight() {
                    dropArea.classList.remove('highlight');
                }
                
                // 处理文件拖放
                dropArea.addEventListener('drop', handleDrop, false);
                
                function handleDrop(e) {
                    const dt = e.dataTransfer;
                    const files = dt.files;
                    handleFiles(files);
                }
                
                // 点击选择文件
                dropArea.addEventListener('click', () => {
                    fileInput.click();
                });
                
                fileInput.addEventListener('change', () => {
                    handleFiles(fileInput.files);
                });
                
                // 处理上传的文件
                function handleFiles(files) {
                    if (files.length === 0) return;
                    
                    const file = files[0];
                    if (!file.type.match('image.*')) return;
                    
                    // 保存原始文件信息
                    originalFileSize = file.size;
                    originalFileType = file.type;
                    
                    // 显示文件信息
                    fileSize.textContent = formatFileSize(originalFileSize);
                    fileType.textContent = originalFileType.split('/')[1].toUpperCase();
                    fileInfo.classList.remove('hidden');
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        cropImage.onload = function() {
                            // 保存原始尺寸
                            originalWidth = cropImage.naturalWidth;
                            originalHeight = cropImage.naturalHeight;
                            
                            fileDimensions.textContent = `${originalWidth} × ${originalHeight} 像素`;
                            
                            // 计算缩放比例以适应容器
                            const container = document.querySelector('.crop-image-container');
                            const maxWidth = container.clientWidth;
                            const maxHeight = 400; // 最大高度
                            
                            // 计算缩放比例
                            scaleFactor = Math.min(
                                maxWidth / originalWidth,
                                maxHeight / originalHeight
                            );
                            
                            // 设置显示尺寸
                            imgWidth = originalWidth * scaleFactor;
                            imgHeight = originalHeight * scaleFactor;
                            
                            cropImage.width = imgWidth;
                            cropImage.height = imgHeight;
                            
                            // 显示图片
                            cropImage.classList.remove('hidden');
                            
                            // 初始化裁切区域（默认大小为图片的一半，居中）
                            cropWidth = Math.floor(imgWidth / 2);
                            cropHeight = Math.floor(imgHeight / 2);
                            cropX = Math.floor((imgWidth - cropWidth) / 2);
                            cropY = Math.floor((imgHeight - cropHeight) / 2);
                            
                            updateCropArea();
                            cropArea.classList.remove('hidden');
                            
                            // 启用按钮
                            cropImageBtn.disabled = false;
                        };
                        cropImage.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
                
                // 更新裁切区域位置和大小
                function updateCropArea() {
                    cropArea.style.width = cropWidth + 'px';
                    cropArea.style.height = cropHeight + 'px';
                    cropArea.style.left = cropX + 'px';
                    cropArea.style.top = cropY + 'px';
                    
                    // 更新输入框（显示原始尺寸，而不是缩放后的尺寸）
                    cropWidthInput.value = Math.round(cropWidth / scaleFactor);
                    cropHeightInput.value = Math.round(cropHeight / scaleFactor);
                    cropXInput.value = Math.round(cropX / scaleFactor);
                    cropYInput.value = Math.round(cropY / scaleFactor);
                }
                
                // 处理裁切区域拖拽
                cropArea.addEventListener('mousedown', function(e) {
                    if (e.target === cropArea) {
                        isDragging = true;
                        startX = e.clientX - cropX;
                        startY = e.clientY - cropY;
                    }
                });
                
                // 处理控制点拖拽
                const handles = cropArea.querySelectorAll('.crop-handle');
                handles.forEach(handle => {
                    handle.addEventListener('mousedown', function(e) {
                        isDragging = true;
                        dragHandle = this;
                        startX = e.clientX;
                        startY = e.clientY;
                        e.stopPropagation();
                    });
                });
                
                document.addEventListener('mousemove', function(e) {
                    if (!isDragging) return;
                    
                    if (dragHandle) {
                        // 调整大小
                        const dx = e.clientX - startX;
                        const dy = e.clientY - startY;
                        
                        if (dragHandle.classList.contains('handle-se')) {
                            cropWidth += dx;
                            cropHeight += dy;
                        } else if (dragHandle.classList.contains('handle-sw')) {
                            cropWidth -= dx;
                            cropHeight += dy;
                            cropX += dx;
                        } else if (dragHandle.classList.contains('handle-ne')) {
                            cropWidth += dx;
                            cropHeight -= dy;
                            cropY += dy;
                        } else if (dragHandle.classList.contains('handle-nw')) {
                            cropWidth -= dx;
                            cropHeight -= dy;
                            cropX += dx;
                            cropY += dy;
                        }
                        
                        // 限制最小尺寸
                        cropWidth = Math.max(10, cropWidth);
                        cropHeight = Math.max(10, cropHeight);
                        
                        // 限制在图片范围内
                        if (cropX < 0) cropX = 0;
                        if (cropY < 0) cropY = 0;
                        if (cropX + cropWidth > imgWidth) {
                            cropWidth = imgWidth - cropX;
                        }
                        if (cropY + cropHeight > imgHeight) {
                            cropHeight = imgHeight - cropY;
                        }
                        
                        startX = e.clientX;
                        startY = e.clientY;
                    } else {
                        // 移动裁切区域
                        cropX = e.clientX - startX;
                        cropY = e.clientY - startY;
                        
                        // 限制在图片范围内
                        if (cropX < 0) cropX = 0;
                        if (cropY < 0) cropY = 0;
                        if (cropX + cropWidth > imgWidth) {
                            cropX = imgWidth - cropWidth;
                        }
                        if (cropY + cropHeight > imgHeight) {
                            cropY = imgHeight - cropHeight;
                        }
                    }
                    
                    updateCropArea();
                });
                
                document.addEventListener('mouseup', function() {
                    isDragging = false;
                    dragHandle = null;
                });
                
                // 输入框事件
                cropWidthInput.addEventListener('change', function() {
                    const originalValue = parseInt(this.value);
                    cropWidth = originalValue * scaleFactor;
                    if (cropX + cropWidth > imgWidth) {
                        cropWidth = imgWidth - cropX;
                    }
                    updateCropArea();
                });
                
                cropHeightInput.addEventListener('change', function() {
                    const originalValue = parseInt(this.value);
                    cropHeight = originalValue * scaleFactor;
                    if (cropY + cropHeight > imgHeight) {
                        cropHeight = imgHeight - cropY;
                    }
                    updateCropArea();
                });
                
                cropXInput.addEventListener('change', function() {
                    const originalValue = parseInt(this.value);
                    cropX = originalValue * scaleFactor;
                    if (cropX < 0) cropX = 0;
                    if (cropX + cropWidth > imgWidth) {
                        cropX = imgWidth - cropWidth;
                    }
                    updateCropArea();
                });
                
                cropYInput.addEventListener('change', function() {
                    const originalValue = parseInt(this.value);
                    cropY = originalValue * scaleFactor;
                    if (cropY < 0) cropY = 0;
                    if (cropY + cropHeight > imgHeight) {
                        cropY = imgHeight - cropHeight;
                    }
                    updateCropArea();
                });
                
                // 重置按钮
                cropResetBtn.addEventListener('click', function() {
                    cropWidth = Math.floor(imgWidth / 2);
                    cropHeight = Math.floor(imgHeight / 2);
                    cropX = Math.floor((imgWidth - cropWidth) / 2);
                    cropY = Math.floor((imgHeight - cropHeight) / 2);
                    updateCropArea();
                });
                
                // 比例按钮
                aspectButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const ratio = parseFloat(this.getAttribute('data-ratio'));
                        
                        // 设置当前宽高比
                        if (cropWidth > 0) {
                            cropHeight = cropWidth * ratio;
                            
                            // 检查是否超出边界
                            if (cropY + cropHeight > imgHeight) {
                                cropHeight = imgHeight - cropY;
                                cropWidth = cropHeight / ratio;
                            }
                            
                            updateCropArea();
                        }
                    });
                });
                
                // 裁切按钮
                cropImageBtn.addEventListener('click', function() {
                    // 计算原始图像上的裁切区域
                    const originalCropX = cropX / scaleFactor;
                    const originalCropY = cropY / scaleFactor;
                    let originalCropWidth = cropWidth / scaleFactor;
                    let originalCropHeight = cropHeight / scaleFactor;
                    
                    // 检查是否要调整尺寸
                    let finalWidth = originalCropWidth;
                    let finalHeight = originalCropHeight;
                    
                    if (resizeWidth.value && resizeHeight.value) {
                        finalWidth = parseInt(resizeWidth.value);
                        finalHeight = parseInt(resizeHeight.value);
                    }
                    
                    cropResultCanvas.width = finalWidth;
                    cropResultCanvas.height = finalHeight;
                    
                    // 创建临时图像用于裁切
                    const tempImg = new Image();
                    tempImg.src = cropImage.src;
                    tempImg.onload = function() {
                        ctx.drawImage(
                            tempImg,
                            originalCropX, originalCropY, originalCropWidth, originalCropHeight,
                            0, 0, finalWidth, finalHeight
                        );
                        
                        // 显示结果信息
                        resultDimensions.textContent = `${finalWidth} × ${finalHeight} 像素`;
                        resultInfo.classList.remove('hidden');
                        
                        // 计算文件大小（近似值）
                        const format = outputFormat.value;
                        const quality = format === 'image/jpeg' ? parseFloat(jpegQuality.value) : 1;
                        
                        // 获取数据URL并计算大小
                        const dataURL = cropResultCanvas.toDataURL(format, quality);
                        const size = calculateDataURLSize(dataURL);
                        resultSize.textContent = formatFileSize(size);
                        
                        cropDownloadBtn.disabled = false;
                    };
                });
                
                // 下载按钮
                cropDownloadBtn.addEventListener('click', function() {
                    if (cropResultCanvas.width === 0) return;
                    
                    const format = outputFormat.value;
                    const quality = format === 'image/jpeg' ? parseFloat(jpegQuality.value) : 1;
                    const ext = format.split('/')[1];
                    
                    const link = document.createElement('a');
                    link.download = 'image-cropped-' + new Date().getTime() + '.' + ext;
                    link.href = cropResultCanvas.toDataURL(format, quality);
                    link.click();
                });
                
                // 辅助函数：格式化文件大小
                function formatFileSize(bytes) {
                    if (bytes < 1024) return bytes + ' B';
                    else if (bytes < 1048576) return (bytes / 1024).toFixed(2) + ' KB';
                    else return (bytes / 1048576).toFixed(2) + ' MB';
                }
                
                // 辅助函数：计算DataURL大小（近似值）
                function calculateDataURLSize(dataURL) {
                    // 减去数据URL前缀的大小
                    const base64 = dataURL.split(',')[1];
                    // Base64编码会增加约33%的大小
                    return Math.floor((base64.length * 3) / 4);
                }
            }
            
            function initTransformTool() {
                const dropArea = document.getElementById('transformDropArea');
                const fileInput = document.getElementById('transformFileInput');
                const previewCanvas = document.getElementById('transformPreviewCanvas');
                const ctx = previewCanvas.getContext('2d');
                const rotateLeftBtn = document.getElementById('rotateLeftBtn');
                const rotateRightBtn = document.getElementById('rotateRightBtn');
                const flipHorizontalBtn = document.getElementById('flipHorizontalBtn');
                const flipVerticalBtn = document.getElementById('flipVerticalBtn');
                const rotationSlider = document.getElementById('rotationSlider');
                const rotationValue = document.getElementById('rotationValue');
                const resetTransformBtn = document.getElementById('resetTransformBtn');
                const applyTransformBtn = document.getElementById('applyTransformBtn');
                const downloadBtn = document.getElementById('transformDownloadBtn');
                const outputFormat = document.getElementById('transformOutputFormat');
                const jpegQuality = document.getElementById('transformJpegQuality');
                const qualityValue = document.getElementById('transformQualityValue');
                const fileInfo = document.getElementById('transformFileInfo');
                const fileSize = document.getElementById('transformFileSize');
                const fileDimensions = document.getElementById('transformFileDimensions');
                const fileType = document.getElementById('transformFileType');
                const resultInfo = document.getElementById('transformResultInfo');
                const resultSize = document.getElementById('transformResultSize');
                const resultDimensions = document.getElementById('transformResultDimensions');
                
                let originalImage = null;
                let currentRotation = 0;
                let currentScaleX = 1;
                let currentScaleY = 1;
                let originalWidth = 0;
                let originalHeight = 0;
                let originalFileSize = 0;
                let originalFileType = '';
                
                // 更新质量显示
                jpegQuality.addEventListener('input', function() {
                    qualityValue.textContent = Math.round(this.value * 100) + '%';
                });
                
                // 旋转滑块事件
                rotationSlider.addEventListener('input', function() {
                    currentRotation = parseInt(this.value);
                    rotationValue.textContent = currentRotation + '°';
                    drawImage();
                });
                
                // 拖放事件处理
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropArea.addEventListener(eventName, preventDefaults, false);
                });
                
                function preventDefaults(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                
                ['dragenter', 'dragover'].forEach(eventName => {
                    dropArea.addEventListener(eventName, highlight, false);
                });
                
                ['dragleave', 'drop'].forEach(eventName => {
                    dropArea.addEventListener(eventName, unhighlight, false);
                });
                
                function highlight() {
                    dropArea.classList.add('highlight');
                }
                
                function unhighlight() {
                    dropArea.classList.remove('highlight');
                }
                
                // 处理文件拖放
                dropArea.addEventListener('drop', handleDrop, false);
                
                function handleDrop(e) {
                    const dt = e.dataTransfer;
                    const files = dt.files;
                    handleFiles(files);
                }
                
                // 点击选择文件
                dropArea.addEventListener('click', () => {
                    fileInput.click();
                });
                
                fileInput.addEventListener('change', () => {
                    handleFiles(fileInput.files);
                });
                
                // 处理上传的文件
                function handleFiles(files) {
                    if (files.length === 0) return;
                    
                    const file = files[0];
                    if (!file.type.match('image.*')) return;
                    
                    // 保存原始文件信息
                    originalFileSize = file.size;
                    originalFileType = file.type;
                    
                    // 显示文件信息
                    fileSize.textContent = formatFileSize(originalFileSize);
                    fileType.textContent = originalFileType.split('/')[1].toUpperCase();
                    fileInfo.classList.remove('hidden');
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        originalImage = new Image();
                        originalImage.onload = function() {
                            // 保存原始尺寸
                            originalWidth = originalImage.width;
                            originalHeight = originalImage.height;
                            
                            fileDimensions.textContent = `${originalWidth} × ${originalHeight} 像素`;
                            
                            // 重置变换参数
                            currentRotation = 0;
                            currentScaleX = 1;
                            currentScaleY = 1;
                            rotationSlider.value = 0;
                            rotationValue.textContent = '0°';
                            
                            // 设置Canvas尺寸
                            previewCanvas.width = originalWidth;
                            previewCanvas.height = originalHeight;
                            
                            // 绘制图片
                            drawImage();
                            
                            // 启用按钮
                            applyTransformBtn.disabled = false;
                            downloadBtn.disabled = false;
                        };
                        originalImage.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
                
                // 绘制图片到Canvas
                function drawImage() {
                    if (!originalImage) return;
                    
                    // 计算旋转后的尺寸
                    const radians = currentRotation * Math.PI / 180;
                    const sin = Math.abs(Math.sin(radians));
                    const cos = Math.abs(Math.cos(radians));
                    
                    const newWidth = Math.floor(originalWidth * cos + originalHeight * sin);
                    const newHeight = Math.floor(originalWidth * sin + originalHeight * cos);
                    
                    // 调整Canvas尺寸
                    previewCanvas.width = newWidth;
                    previewCanvas.height = newHeight;
                    
                    // 清除Canvas
                    ctx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);
                    
                    // 设置中心点
                    ctx.save();
                    ctx.translate(newWidth / 2, newHeight / 2);
                    
                    // 应用旋转
                    ctx.rotate(radians);
                    
                    // 应用翻转
                    ctx.scale(currentScaleX, currentScaleY);
                    
                    // 绘制图片
                    ctx.drawImage(
                        originalImage, 
                        -originalWidth / 2, 
                        -originalHeight / 2,
                        originalWidth,
                        originalHeight
                    );
                    
                    ctx.restore();
                }
                
                // 旋转按钮事件
                rotateLeftBtn.addEventListener('click', function() {
                    currentRotation -= 90;
                    if (currentRotation < 0) currentRotation += 360;
                    rotationSlider.value = currentRotation;
                    rotationValue.textContent = currentRotation + '°';
                    drawImage();
                });
                
                rotateRightBtn.addEventListener('click', function() {
                    currentRotation += 90;
                    if (currentRotation >= 360) currentRotation -= 360;
                    rotationSlider.value = currentRotation;
                    rotationValue.textContent = currentRotation + '°';
                    drawImage();
                });
                
                // 翻转按钮事件
                flipHorizontalBtn.addEventListener('click', function() {
                    currentScaleX *= -1;
                    drawImage();
                });
                
                flipVerticalBtn.addEventListener('click', function() {
                    currentScaleY *= -1;
                    drawImage();
                });
                
                // 重置按钮
                resetTransformBtn.addEventListener('click', function() {
                    if (!originalImage) return;
                    
                    currentRotation = 0;
                    currentScaleX = 1;
                    currentScaleY = 1;
                    rotationSlider.value = 0;
                    rotationValue.textContent = '0°';
                    
                    previewCanvas.width = originalWidth;
                    previewCanvas.height = originalHeight;
                    
                    drawImage();
                });
                
                // 应用转换按钮
                applyTransformBtn.addEventListener('click', function() {
                    if (!originalImage) return;
                    
                    // 计算文件大小（近似值）
                    const format = outputFormat.value;
                    const quality = format === 'image/jpeg' ? parseFloat(jpegQuality.value) : 1;
                    
                    // 获取数据URL并计算大小
                    const dataURL = previewCanvas.toDataURL(format, quality);
                    const size = calculateDataURLSize(dataURL);
                    
                    // 显示结果信息
                    resultDimensions.textContent = `${previewCanvas.width} × ${previewCanvas.height} 像素`;
                    resultSize.textContent = formatFileSize(size);
                    resultInfo.classList.remove('hidden');
                });
                
                // 下载按钮
                downloadBtn.addEventListener('click', function() {
                    if (!originalImage) return;
                    
                    const format = outputFormat.value;
                    const quality = format === 'image/jpeg' ? parseFloat(jpegQuality.value) : 1;
                    const ext = format.split('/')[1];
                    
                    const link = document.createElement('a');
                    link.download = 'image-transformed-' + new Date().getTime() + '.' + ext;
                    link.href = previewCanvas.toDataURL(format, quality);
                    link.click();
                });
                
                // 辅助函数：格式化文件大小
                function formatFileSize(bytes) {
                    if (bytes < 1024) return bytes + ' B';
                    else if (bytes < 1048576) return (bytes / 1024).toFixed(2) + ' KB';
                    else return (bytes / 1048576).toFixed(2) + ' MB';
                }
                
                // 辅助函数：计算DataURL大小（近似值）
                function calculateDataURLSize(dataURL) {
                    // 减去数据URL前缀的大小
                    const base64 = dataURL.split(',')[1];
                    // Base64编码会增加约33%的大小
                    return Math.floor((base64.length * 3) / 4);
                }
            }
        });
    </script>
</body>
</html>