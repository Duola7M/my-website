<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>备忘录 - 带导入导出功能</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            /* background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); */
        background: url('images/备忘录background.jpg') center center/cover no-repeat;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #333;
        }
        
        .container {/*备忘录区域*/
            display: flex;
            width: 90%;
            max-width: 1200px;
            height: 85vh;
            background: rgba(255, 255, 255, 0.25);
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
            overflow: hidden;
        }
        
        .sidebar {/*我的备忘录区域*/
            width: 35%;
            background: rgba(255, 255, 255, 0.25);
            color: white;
            padding: 25px;
            overflow-y: auto;
            position: relative;
        }
        
        .main {
            width: 65%;
            padding: 35px;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        h1 {
            margin-bottom: 25px;
            color: #2c3e50;
            text-align: center;
            font-weight: 700;
            font-size: 2.2rem;
        }
        
        h2 {
            color: white;
            margin-bottom: 25px;
            text-align: center;
            font-weight: 600;
            font-size: 1.8rem;
        }
        
        .memo-form {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            gap: 20px;
        }
        
        input, textarea {
            padding: 16px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        input:focus, textarea:focus {
            border-color: #4a6fa5;
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
        }
        
        textarea {/*备忘录正文区域*/
            flex-grow: 1;
            resize: none;
            background: rgba(255, 255, 255, 0.25);
            line-height: 1.6;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 14px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #4a6fa5;
            color: white;
            flex: 1;
        }
        
        .btn-primary:hover {
            background: #385d8a;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn-secondary {
            background: #e74c3c;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn-success {
            background: #2ecc71;
            color: white;
            flex: 1;
        }
        
        .btn-success:hover {
            background: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn-export {
            background: #9b59b6;
            color: white;
        }
        
        .btn-export:hover {
            background: #8e44ad;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn-import {
            background: #f39c12;
            color: white;
        }
        
        .btn-import:hover {
            background: #d35400;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .memo-list {
            list-style: none;
            margin-top: 10px;
        }
        
        .memo-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 18px;
            margin-bottom: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border-left: 5px solid transparent;
        }
        
        .memo-item:hover {
            background: rgba(255, 255, 255, 0.2);
            border-left-color: #ffeb3b;
            transform: translateX(5px);
        }
        
        .memo-item.active {
            background: rgba(255, 255, 255, 0.3);
            border-left-color: #ffeb3b;
        }
        
        .memo-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1.1rem;
            padding-right: 30px;
        }
        
        .memo-preview {
            font-size: 14px;
            opacity: 0.9;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding-right: 30px;
        }
        
        .memo-date {
            font-size: 12px;
            opacity: 0.7;
            margin-top: 8px;
        }
        
        .delete-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
        }
        
        .memo-item:hover .delete-btn {
            opacity: 1;
            background: rgba(231, 76, 60, 0.2);
        }
        
        .delete-btn:hover {
            color: white;
            background: rgba(231, 76, 60, 0.8) !important;
            transform: scale(1.1);
        }
        
        .empty-state {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 50px;
            font-size: 1.1rem;
        }
        
        .search-box {
            margin-bottom: 20px;
            position: relative;
        }
        
        .search-box input {
            width: 100%;
            padding-left: 40px;
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid transparent;
            color: white;
        }
        
        .search-box input:focus {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.7);
        }
        
        .logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo i {
            font-size: 3rem;
            color: #ffeb3b;
            margin-bottom: 10px;
        }
        
        .import-export-options {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        .import-export-options h3 {
            margin-bottom: 15px;
            color: white;
            text-align: center;
        }
        
        .import-export-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .import-export-btn {
            padding: 10px 15px;
            font-size: 14px;
            width: 100%;
        }
        
        .file-input {
            display: none;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: #2c3e50;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .import-preview {
            margin-top: 20px;
            border: 1px solid #e1e8ed;
            border-radius: 10px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .import-item {
            padding: 10px;
            border-bottom: 1px solid #e1e8ed;
        }
        
        .import-item:last-child {
            border-bottom: none;
        }
        
        .import-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        @media (max-width: 900px) {
            .container {
                flex-direction: column;
                height: auto;
            }
            
            .sidebar, .main {
                width: 100%;
            }
            
            .sidebar {
                max-height: 350px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .import-export-buttons {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .import-export-btn {
                width: auto;
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="logo">
                <i class="fas fa-sticky-note"></i>
                <h2>我的备忘录</h2>
            </div>
            
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="搜索备忘录...">
            </div>
            
            <ul class="memo-list" id="memoList">
                <!-- 备忘录列表将在这里动态生成 -->
            </ul>
            
            <div class="import-export-options">
                <h3>导入/导出选项</h3>
                <div class="import-export-buttons">
                    <button class="btn-export import-export-btn" id="exportCurrentBtn">
                        <i class="fas fa-file-export"></i> 导出当前
                    </button>
                    <button class="btn-export import-export-btn" id="exportAllBtn">
                        <i class="fas fa-file-archive"></i> 导出全部
                    </button>
                    <button class="btn-import import-export-btn" id="importTxtBtn">
                        <i class="fas fa-file-import"></i> 导入TXT
                    </button>
                    <button class="btn-import import-export-btn" id="importZipBtn">
                        <i class="fas fa-file-archive"></i> 导入ZIP
                    </button>
                </div>
                <input type="file" id="fileInput" class="file-input" accept=".txt,.zip">
            </div>
        </div>
        
        <div class="main">
            <h1>备忘录 - 导入导出功能</h1>
            <form class="memo-form" id="memoForm">
                <input type="text" id="memoTitle" placeholder="输入备忘录标题" required>
                <textarea id="memoContent" placeholder="输入备忘录内容..." required></textarea>
                <div class="buttons">
                    <button type="submit" class="btn-primary" id="saveBtn">
                        <i class="fas fa-save"></i> 保存备忘录
                    </button>
                    <button type="button" class="btn-success" id="newBtn">
                        <i class="fas fa-plus"></i> 新建备忘录
                    </button>
                    <button type="button" class="btn-secondary" id="clearBtn">
                        <i class="fas fa-trash"></i> 清空所有
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 导入确认模态框 -->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">导入确认</h3>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <p>以下备忘录将被导入：</p>
            <div class="import-preview" id="importPreview">
                <!-- 导入预览将在这里显示 -->
            </div>
            <div class="import-actions">
                <button class="btn-secondary" id="cancelImport">取消</button>
                <button class="btn-success" id="confirmImport">确认导入</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 获取DOM元素
            const memoForm = document.getElementById('memoForm');
            const memoTitle = document.getElementById('memoTitle');
            const memoContent = document.getElementById('memoContent');
            const memoList = document.getElementById('memoList');
            const saveBtn = document.getElementById('saveBtn');
            const newBtn = document.getElementById('newBtn');
            const clearBtn = document.getElementById('clearBtn');
            const searchInput = document.getElementById('searchInput');
            const exportCurrentBtn = document.getElementById('exportCurrentBtn');
            const exportAllBtn = document.getElementById('exportAllBtn');
            const importTxtBtn = document.getElementById('importTxtBtn');
            const importZipBtn = document.getElementById('importZipBtn');
            const fileInput = document.getElementById('fileInput');
            const importModal = document.getElementById('importModal');
            const importPreview = document.getElementById('importPreview');
            const closeModal = document.getElementById('closeModal');
            const cancelImport = document.getElementById('cancelImport');
            const confirmImport = document.getElementById('confirmImport');
            
            let memos = JSON.parse(localStorage.getItem('memos')) || [];
            let currentMemoId = null;
            let importMemos = []; // 存储待导入的备忘录
            
            // 初始化显示备忘录列表
            renderMemoList();
            
            // 表单提交事件（保存备忘录）
            memoForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const title = memoTitle.value.trim();
                const content = memoContent.value.trim();
                
                if (title && content) {
                    if (currentMemoId) {
                        // 更新现有备忘录
                        const index = memos.findIndex(memo => memo.id === currentMemoId);
                        if (index !== -1) {
                            memos[index].title = title;
                            memos[index].content = content;
                            memos[index].date = new Date().toISOString();
                        }
                    } else {
                        // 添加新备忘录
                        const newMemo = {
                            id: Date.now(),
                            title,
                            content,
                            date: new Date().toISOString()
                        };
                        memos.push(newMemo);
                    }
                    
                    // 保存到localStorage
                    localStorage.setItem('memos', JSON.stringify(memos));
                    
                    // 重新渲染列表
                    renderMemoList();
                    
                    // 重置表单
                    if (!currentMemoId) {
                        memoForm.reset();
                    }
                }
            });
            
            // 新建备忘录按钮
            newBtn.addEventListener('click', function() {
                currentMemoId = null;
                memoForm.reset();
                removeActiveClass();
            });
            
            // 清空所有按钮
            clearBtn.addEventListener('click', function() {
                if (confirm('确定要清空所有备忘录吗？此操作不可撤销！')) {
                    memos = [];
                    localStorage.removeItem('memos');
                    renderMemoList();
                    memoForm.reset();
                    currentMemoId = null;
                }
            });
            
            // 搜索功能
            searchInput.addEventListener('input', function() {
                renderMemoList();
            });
            
            // 导出当前备忘录
            exportCurrentBtn.addEventListener('click', function() {
                if (!currentMemoId) {
                    alert('请先选择要导出的备忘录！');
                    return;
                }
                
                const memo = memos.find(m => m.id === currentMemoId);
                if (memo) {
                    exportMemoToTxt(memo);
                }
            });
            
            // 导出所有备忘录
            exportAllBtn.addEventListener('click', function() {
                if (memos.length === 0) {
                    alert('没有可导出的备忘录！');
                    return;
                }
                
                // 创建ZIP文件
                createZipWithAllMemos();
            });
            
            // 导入TXT按钮
            importTxtBtn.addEventListener('click', function() {
                fileInput.accept = '.txt';
                fileInput.click();
            });
            
            // 导入ZIP按钮
            importZipBtn.addEventListener('click', function() {
                fileInput.accept = '.zip';
                fileInput.click();
            });
            
            // 文件选择事件
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const fileExtension = file.name.split('.').pop().toLowerCase();
                
                if (fileExtension === 'txt') {
                    importTxtFile(file);
                } else if (fileExtension === 'zip') {
                    importZipFile(file);
                } else {
                    alert('不支持的文件格式！请选择TXT或ZIP文件。');
                }
                
                // 重置文件输入
                fileInput.value = '';
            });
            
            // 关闭模态框
            closeModal.addEventListener('click', function() {
                importModal.style.display = 'none';
            });
            
            cancelImport.addEventListener('click', function() {
                importModal.style.display = 'none';
            });
            
            // 确认导入
            confirmImport.addEventListener('click', function() {
                if (importMemos.length > 0) {
                    // 合并备忘录
                    memos = [...memos, ...importMemos];
                    localStorage.setItem('memos', JSON.stringify(memos));
                    renderMemoList();
                    alert(`成功导入 ${importMemos.length} 条备忘录！`);
                }
                
                importModal.style.display = 'none';
                importMemos = [];
            });
            
            // 导入TXT文件
            function importTxtFile(file) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const content = e.target.result;
                    const fileName = file.name.replace('.txt', '');
                    
                    // 从内容中提取标题（第一行）
                    const firstLine = content.split('\n')[0];
                    let title = fileName;
                    
                    if (firstLine.startsWith('备忘录标题:')) {
                        title = firstLine.replace('备忘录标题:', '').trim();
                    }
                    
                    // 创建新备忘录对象
                    const newMemo = {
                        id: Date.now(),
                        title: title,
                        content: content,
                        date: new Date().toISOString()
                    };
                    
                    importMemos = [newMemo];
                    showImportPreview();
                };
                
                reader.readAsText(file);
            }
            
            // 导入ZIP文件
            function importZipFile(file) {
                // 动态导入JSZip库
                import('https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js')
                    .then(() => {
                        const reader = new FileReader();
                        
                        reader.onload = function(e) {
                            const data = e.target.result;
                            const zip = new JSZip();
                            
                            zip.loadAsync(data).then(function(contents) {
                                importMemos = [];
                                const promises = [];
                                
                                // 遍历ZIP中的所有文件
                                Object.keys(contents.files).forEach(function(filename) {
                                    if (!contents.files[filename].dir && filename.endsWith('.txt')) {
                                        const promise = zip.file(filename).async('text').then(function(content) {
                                            // 从文件名中提取标题
                                            let title = filename.replace('.txt', '');
                                            
                                            // 从内容中提取标题（第一行）
                                            const firstLine = content.split('\n')[0];
                                            if (firstLine.startsWith('备忘录标题:')) {
                                                title = firstLine.replace('备忘录标题:', '').trim();
                                            }
                                            
                                            return {
                                                id: Date.now() + Math.random(), // 确保ID唯一
                                                title: title,
                                                content: content,
                                                date: new Date().toISOString()
                                            };
                                        });
                                        
                                        promises.push(promise);
                                    }
                                });
                                
                                // 等待所有文件处理完成
                                Promise.all(promises).then(function(memos) {
                                    importMemos = memos;
                                    showImportPreview();
                                });
                            });
                        };
                        
                        reader.readAsArrayBuffer(file);
                    })
                    .catch(err => {
                        console.error('加载ZIP库失败:', err);
                        alert('导入ZIP功能需要加载额外库，请检查网络连接后重试');
                    });
            }
            
            // 显示导入预览
            function showImportPreview() {
                importPreview.innerHTML = '';
                
                if (importMemos.length === 0) {
                    importPreview.innerHTML = '<p>没有找到可导入的备忘录</p>';
                    return;
                }
                
                importMemos.forEach(memo => {
                    const div = document.createElement('div');
                    div.className = 'import-item';
                    div.innerHTML = `
                        <strong>${memo.title}</strong>
                        <div>${memo.content.substring(0, 50)}${memo.content.length > 50 ? '...' : ''}</div>
                    `;
                    importPreview.appendChild(div);
                });
                
                importModal.style.display = 'flex';
            }
            
            // 导出单个备忘录为TXT文件
            function exportMemoToTxt(memo) {
                const content = `备忘录标题: ${memo.title}\n创建时间: ${formatDate(memo.date)}\n\n${memo.content}`;
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `${memo.title}.txt`;
                document.body.appendChild(a);
                a.click();
                
                // 清理
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
            }
            
            // 创建包含所有备忘录的ZIP文件
            function createZipWithAllMemos() {
                // 动态导入JSZip库
                import('https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js')
                    .then(() => {
                        return import('https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js');
                    })
                    .then(() => {
                        const zip = new JSZip();
                        
                        // 添加每个备忘录到ZIP
                        memos.forEach(memo => {
                            const content = `备忘录标题: ${memo.title}\n创建时间: ${formatDate(memo.date)}\n\n${memo.content}`;
                            zip.file(`${memo.title}.txt`, content);
                        });
                        
                        // 生成ZIP文件
                        zip.generateAsync({ type: 'blob' })
                            .then(blob => {
                                saveAs(blob, '所有备忘录.zip');
                            });
                    })
                    .catch(err => {
                        console.error('加载ZIP库失败:', err);
                        alert('导出功能需要加载额外库，请检查网络连接后重试');
                    });
            }
            
            // 格式化日期
            function formatDate(dateString) {
                const date = new Date(dateString);
                return `${date.getFullYear()}-${(date.getMonth()+1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
            }
            
            // 渲染备忘录列表
            function renderMemoList() {
                memoList.innerHTML = '';
                
                const searchTerm = searchInput.value.toLowerCase();
                let filteredMemos = memos;
                
                if (searchTerm) {
                    filteredMemos = memos.filter(memo => 
                        memo.title.toLowerCase().includes(searchTerm) || 
                        memo.content.toLowerCase().includes(searchTerm)
                    );
                }
                
                if (filteredMemos.length === 0) {
                    const emptyText = searchTerm ? 
                        '没有找到匹配的备忘录' : 
                        '暂无备忘录，点击"新建备忘录"开始创建';
                    memoList.innerHTML = `<div class="empty-state">${emptyText}</div>`;
                    return;
                }
                
                // 按日期降序排列
                filteredMemos.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                filteredMemos.forEach(memo => {
                    const li = document.createElement('li');
                    li.className = 'memo-item';
                    li.dataset.id = memo.id;
                    
                    // 格式化日期
                    const formattedDate = formatDate(memo.date);
                    
                    li.innerHTML = `
                        <div class="memo-title">${memo.title}</div>
                        <div class="memo-preview">${memo.content.substring(0, 40)}${memo.content.length > 40 ? '...' : ''}</div>
                        <div class="memo-date">${formattedDate}</div>
                        <button class="delete-btn">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    
                    // 点击备忘录项进行编辑
                    li.addEventListener('click', function(e) {
                        if (e.target.classList.contains('delete-btn') || e.target.closest('.delete-btn')) {
                            return;
                        }
                        
                        currentMemoId = memo.id;
                        memoTitle.value = memo.title;
                        memoContent.value = memo.content;
                        
                        // 高亮显示选中的备忘录
                        removeActiveClass();
                        li.classList.add('active');
                    });
                    
                    // 删除按钮事件
                    const deleteBtn = li.querySelector('.delete-btn');
                    deleteBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        
                        if (confirm('确定要删除这个备忘录吗？')) {
                            memos = memos.filter(m => m.id !== memo.id);
                            localStorage.setItem('memos', JSON.stringify(memos));
                            
                            if (currentMemoId === memo.id) {
                                currentMemoId = null;
                                memoForm.reset();
                            }
                            
                            renderMemoList();
                        }
                    });
                    
                    memoList.appendChild(li);
                });
            }
            
            // 移除所有活动类
            function removeActiveClass() {
                const items = document.querySelectorAll('.memo-item');
                items.forEach(item => item.classList.remove('active'));
            }
        });
    </script>
</body>
</html>